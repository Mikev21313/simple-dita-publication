// Navigate to a specific page
function navigateToPage(pageId, pushState = true) {
  debug('Navigating to page:', pageId);
  
  // Update active state in navigation
  updateActiveNavItem(pageId);
  
  // Expand navigation to show the current page
  expandNavigationTo(pageId);
  
  // Update the URL
  if (pushState) {
    history.pushState({ pageId }, '', `#${pageId}`);
  }
  
  // Show loading indicator
  document.body.classList.add('loading');
  
  // Update current page
  currentPage = pageId;
  
  // Get alternate ID (convert underscores to hyphens)
  const altPageId = pageId.replace(/_/g, '-');
  
  // Load content
  loadContent(pageId)
    .then(content => {
      // Update title
      const title = getPageTitle(pageId);
      contentTitleEl.textContent = title;
      document.title = title;
      
      // IMPROVED SOLUTION FOR DUPLICATE HEADINGS:
      // Create a temporary div to hold the content for manipulation
      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = content;
      
      // Find all h1 elements in the content
      const h1Elements = tempDiv.querySelectorAll('h1');
      
      // Check each h1 for duplicate with our title
      h1Elements.forEach(h1 => {
        // Compare text content (case-insensitive and ignoring extra whitespace)
        if (h1.textContent.trim().toLowerCase() === title.trim().toLowerCase()) {
          // Remove this h1 element
          h1.parentNode.removeChild(h1);
        }
      });
      
      // Get the modified content
      content = tempDiv.innerHTML;
      
      // Update content
      contentEl.innerHTML = content;
      
      // Hide loading indicator
      document.body.classList.remove('loading');
      debug('Content loaded successfully');
    })
    .catch(error => {
      debug('Error loading content:', error.message);
      // Try alternate ID
      loadContent(altPageId)
        .then(content => {
          contentTitleEl.textContent = getPageTitle(pageId);
          document.title = getPageTitle(pageId);
          
          // Apply the same duplicate heading fix
          const tempDiv = document.createElement('div');
          tempDiv.innerHTML = content;
          
          const h1Elements = tempDiv.querySelectorAll('h1');
          h1Elements.forEach(h1 => {
            if (h1.textContent.trim().toLowerCase() === getPageTitle(pageId).trim().toLowerCase()) {
              h1.parentNode.removeChild(h1);
            }
          });
          
          contentEl.innerHTML = tempDiv.innerHTML;
          document.body.classList.remove('loading');
          debug('Content loaded from alternate ID');
        })
        .catch(altError => {
          console.error('Failed to load content:', altError);
          contentEl.innerHTML = `
            <div class="error">
              <h2>Content Not Found</h2>
              <p>The requested content "${pageId}" could not be loaded.</p>
              <p>Please select another topic from the navigation menu.</p>
            </div>
          `;
          document.body.classList.remove('loading');
        });
    });
}