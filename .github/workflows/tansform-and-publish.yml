<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Branch Previews - Automotive Documentation</title>
  <style>
    /* Base styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: "LCARS", Arial, sans-serif;
      line-height: 1.6;
      color: #fff;
      background-color: #000;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    /* LCARS-inspired styles */
    .lcars-header {
      display: flex;
      margin-bottom: 30px;
      border-radius: 20px 0 0 20px;
      overflow: hidden;
    }
    
    .lcars-bar {
      background-color: #FF9900;
      width: 30px;
      height: 120px;
      margin-right: 10px;
    }
    
    .lcars-title {
      background-color: #FF9900;
      padding: 20px;
      flex-grow: 1;
      border-radius: 0 20px 20px 0;
    }
    
    .lcars-title h1 {
      color: #000;
      font-size: 32px;
      font-weight: bold;
    }
    
    .lcars-title p {
      color: #000;
      margin-top: 10px;
      font-size: 18px;
    }
    
    .lcars-panel {
      background-color: #111;
      border: 2px solid #FF9900;
      border-radius: 15px;
      padding: 15px;
      margin-bottom: 20px;
    }
    
    .lcars-panel h2 {
      color: #9999ff;
      border-bottom: 2px solid #9999ff;
      padding-bottom: 10px;
      margin-bottom: 15px;
    }
    
    /* Branch list styling */
    .branch-list {
      list-style-type: none;
    }
    
    .branch-item {
      background-color: #222;
      border-left: 5px solid #9999ff;
      margin-bottom: 10px;
      padding: 15px;
      border-radius: 0 5px 5px 0;
      transition: all 0.3s ease;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .branch-item:hover {
      background-color: #333;
      transform: translateX(5px);
    }
    
    .branch-info {
      flex-grow: 1;
    }
    
    .branch-name {
      font-weight: bold;
      color: #FF9900;
      display: block;
      font-size: 18px;
    }
    
    .branch-date {
      font-size: 14px;
      color: #999;
      display: block;
      margin-top: 5px;
    }
    
    .branch-link {
      background-color: #9999ff;
      color: #000;
      padding: 8px 15px;
      border-radius: 15px;
      text-decoration: none;
      font-weight: bold;
      transition: background-color 0.3s ease;
    }
    
    .branch-link:hover {
      background-color: #FF9900;
    }
    
    .back-link {
      display: inline-block;
      margin-top: 20px;
      color: #9999ff;
      text-decoration: none;
      padding: 10px 20px;
      background-color: #222;
      border-radius: 15px;
      transition: all 0.3s ease;
    }
    
    .back-link:hover {
      background-color: #333;
      color: #FF9900;
    }
    
    .no-branches {
      text-align: center;
      padding: 20px;
      color: #999;
      font-style: italic;
      background-color: #222;
      border-radius: 5px;
    }
    
    .lcars-footer {
      display: flex;
      margin-top: 30px;
      align-items: center;
    }
    
    .footer-bar {
      background-color: #FF9900;
      height: 20px;
      flex-grow: 1;
      border-radius: 0 10px 10px 0;
    }
    
    .footer-text {
      background-color: #111;
      padding: 10px 20px;
      border-radius: 10px;
      margin-left: 20px;
      border: 2px solid #FF9900;
    }
  </style>
</head>
<body>
  <div class="lcars-header">
    <div class="lcars-bar"></div>
    <div class="lcars-title">
      <h1>BRANCH PREVIEWS</h1>
      <p>Documentation preview builds for active development branches</p>
    </div>
  </div>
  
  <div class="lcars-panel">
    <h2>AVAILABLE BRANCH PREVIEWS</h2>
    <div id="branches-container">
      <p class="no-branches">Accessing branch database... please stand by</p>
    </div>
  </div>
  
  <a href="../" class="back-link">‚Üê Return to main documentation</a>
  
  <div class="lcars-footer">
    <div class="footer-bar"></div>
    <div class="footer-text">
      Last updated: <span id="last-updated">Calculating...</span>
    </div>
  </div>
  
  <script>
    // Function to format date in Star Trek LCARS style
    function formatStarDate(dateString) {
      const date = new Date(dateString);
      const year = date.getFullYear();
      const month = date.getMonth() + 1;
      const day = date.getDate();
      
      // Create a Star Trek style stardate (just for fun)
      const stardate = Math.floor((year - 2000) * 1000 + (month * 100) + day);
      
      return `Stardate ${stardate}.${date.getHours()}`;
    }
    
    // Function to calculate time ago
    function timeAgo(dateString) {
      const date = new Date(dateString);
      const now = new Date();
      const seconds = Math.floor((now - date) / 1000);
      
      let interval = Math.floor(seconds / 31536000);
      if (interval > 1) return interval + " years ago";
      if (interval === 1) return "1 year ago";
      
      interval = Math.floor(seconds / 2592000);
      if (interval > 1) return interval + " months ago";
      if (interval === 1) return "1 month ago";
      
      interval = Math.floor(seconds / 86400);
      if (interval > 1) return interval + " days ago";
      if (interval === 1) return "1 day ago";
      
      interval = Math.floor(seconds / 3600);
      if (interval > 1) return interval + " hours ago";
      if (interval === 1) return "1 hour ago";
      
      interval = Math.floor(seconds / 60);
      if (interval > 1) return interval + " minutes ago";
      if (interval === 1) return "1 minute ago";
      
      return Math.floor(seconds) + " seconds ago";
    }
    
    // Function to fetch and display branch data
    async function fetchBranchData() {
      try {
        const response = await fetch('./branches.json');
        if (!response.ok) {
          throw new Error('No branch data available');
        }
        
        const data = await response.json();
        const container = document.getElementById('branches-container');
        
        if (data.branches.length === 0) {
          container.innerHTML = '<p class="no-branches">No branch previews currently available.</p>';
          return;
        }
        
        // Sort branches by date, newest first
        data.branches.sort((a, b) => new Date(b.updated_at) - new Date(a.updated_at));
        
        // Update last updated timestamp
        document.getElementById('last-updated').textContent = formatStarDate(data.last_updated);
        
        // Create branch list
        const ul = document.createElement('ul');
        ul.className = 'branch-list';
        
        data.branches.forEach(branch => {
          const li = document.createElement('li');
          li.className = 'branch-item';
          
          const branchSlug = branch.name.replace(/\//g, '-').toLowerCase();
          
          li.innerHTML = `
            <div class="branch-info">
              <span class="branch-name">${branch.name}</span>
              <span class="branch-date">${timeAgo(branch.updated_at)}</span>
            </div>
            <a href="../preview/branch-${branchSlug}/" class="branch-link">View Preview</a>
          `;
          
          ul.appendChild(li);
        });
        
        container.innerHTML = '';
        container.appendChild(ul);
        
      } catch (error) {
        console.error('Error loading branch data:', error);
        document.getElementById('branches-container').innerHTML = 
          '<p class="no-branches">Ship sensors detect no branch previews available. Please check back later.</p>';
      }
    }
    
    // Initialize
    document.addEventListener('DOMContentLoaded', fetchBranchData);
    
    // Refresh data every 5 minutes
    setInterval(fetchBranchData, 300000);
  </script>
</body>
</html>